	Dado tu número $n$:
	\begin{enumerate}
		\item Sea $d$ el primer elemento de la sucesión $5, -7, 9, -11, 13,\dots$ que satisface que el símbolo
		de Jacobi $\displaystyle \left(\frac{d}{n}\right) = -1$.
		\item Con el discriminante $d$, define $r = n+1$\footnote{En esta práctica, definimos $r$ igual que en
		la práctica anterior $r = n - \displaystyle \left(\frac{d}{n}\right)$ con la diferencia de que, por la
		elección del discriminante $d$, se tiene que $\displaystyle \left(\frac{d}{n}\right) = -1$.}, $P = 1$,
		$Q = \displaystyle \frac{1-d}{4}$, el entero cuadrático $\alpha$ y las sucesiones de Lucas asociadas.
		\item Si tu $n$ fuera primo, ¿Qué debería pasarle a los términos $V_r$ y $U_r$? ¿Y a los términos
		$V_{\frac{r}{2}}$ y $U_{\frac{r}{2}}$?
		\item Calcula los términos $V_{\frac{r}{2}}$, $U_{\frac{r}{2}}$, $V_r$ y $U_r$ módulo $n$ de las sucesiones
		de Lucas con el último algoritmo iterativo.
		\item ¿Se verifica el Teorema Pequeño de Fermat (TPF) para $\alpha$? ¿Qué deduces sobre la primalidad
		de tu $n$?
	\end{enumerate}

\section*{Solución}
	\begin{enumerate}
		\item Para calcular el símbolo de Jacobi $\displaystyle \left(\frac{d}{n}\right)$\footnote{Recordemos que
		para este ejercicio, nuestro $n$ era distinto, en lugar de ser el DNI, es $n = 678650380744579$.} haremos
		uso del algorimto \ref{Jac-symbol} para cada uno de los valores hasta encontrar el que nos devuelva el
		valor deseado:
		$$\left(\frac{5}{n}\right) = \left(\frac{5}{678650380744579} \right)= \left(\frac{678650380744579}{5}\right)
		= \left(\frac{4}{5}\right) = \left(\frac{2^2}{5}\right) = \left(\frac{2}{5}\right)^2 = 1$$
		
		$$\displaystyle \left(\frac{-7}{n}\right) = \left(\frac{678650380744572}{678650380744579} \right)=
		-\left(\frac{339325190372286}{678650380744579} \right) = \left(\frac{169662595186143}{678650380744579} \right)
		= \atop \displaystyle -\left(\frac{678650380744579}{169662595186143} \right) = -\left(\frac{7}
		{169662595186143} \right) = \left(\frac{169662595186143}{7} \right) = \left(\frac{3}{7} \right) =
		-\left(\frac{7}{3} \right) = -\left(\frac{1}{3} \right) = -1$$
		
		\item Dado que $d = -7$, primero definimos $r = n+1 = 678650380744580$.
		
		Claramente, definimos $\displaystyle \alpha = \frac{P + \sqrt{\Delta}}{2}$ con $\Delta = P^2 - 4Q$,
		y tenemos que $\displaystyle \Delta = 1^2 - 4\left(\frac{1-d}{4}\right) = 1-8 = -7$ y $\displaystyle
		\alpha = \frac{1 + \sqrt{-7}}{2}$
		
		Podemos comprobar que nuestro $\alpha$ es un entero algebraico pues $a = \alpha + \beta, b = \alpha
		\beta \in \mathbb{Z}$ con $\displaystyle \beta = \overline{\alpha} = \frac{P - \sqrt{\Delta}}{2}$:
		$$\displaystyle a = \frac{P + \sqrt{\Delta}}{2} + \frac{P - \sqrt{\Delta}}{2} = P = 1, \qquad
		b = \frac{P + \sqrt{\Delta}}{2} \cdot \frac{P - \sqrt{\Delta}}{2} = \frac{P^2-\Delta}{2^2} =
		\frac{P^2-(P^2-4Q)}{4} = Q = \left(\frac{1-d}{4}\right) = 2$$
		
		De aquí deducimos que su polinomio primitivo mínimo es $f(x) = x^2 -x +2$. A partir de aquí, podemos
		deducir que $\alpha^2 -\alpha +2 = 0 \Leftrightarrow \alpha^2  = \alpha -2 \Leftrightarrow \alpha^n =
		\alpha^{n-1} - 2\alpha^{n-2}$
		
		Ahora, como $\mathbb{Q\left(\alpha\right)} = \mathbb{Q\left(\sqrt{\Delta}\right)}$ con $\left\lbrace1,
		\sqrt{\Delta}\right\rbrace$ es una base de este cuerpo, podemos escribir $\displaystyle \alpha^n =
		\frac{V_n}{2} + \frac{U_n}{2}\sqrt{\Delta}$ con $U_i, V_i \in \mathbb{Z}$.
		
		Además, podemos usar la expresión $\alpha^n  = \alpha^{n-1} - 2\alpha^{n-2}$ encontrada antes para
		concluir que $\displaystyle \frac{V_n}{2} + \frac{U_n}{2}\sqrt{\Delta} = \alpha^n  = \alpha^{n-1} -
		2\alpha^{n-2} = \left(\frac{V_{n-1}}{2} + \frac{U_{n-1}}{2}\sqrt{\Delta}\right) -2\left(\frac{V_{n-2}}{2} +
		\frac{U_{n-2}}{2}\sqrt{\Delta}\right) = \frac{V_{n-1}-2V_{n-2}}{2} + \frac{U_{n-1}-2U_{n-2}}{2}\sqrt{\Delta}$
		
		De donde concluimos que:
		$$\left\lbrace
			V_n = V_{n-1}-2V_{n-2} \atop
			U_n = U_{n-1}-2U_{n-2}
		\right.$$
		
		Cumplen por tanto una relación de recurrencia, ahora sólo tenemos que calcular algunos valores para tener
		completamente determinada la recurrencia. En nuestro caso, es fácil ver que:
		$$\left.
			\displaystyle 1 = \alpha^0 = \frac{V_0}{2} + \frac{U_0}{2}\sqrt{\Delta} \Rightarrow V_0 = 2, \quad U_0 = 0 \atop
			\displaystyle \frac{P + \sqrt{\Delta}}{2} = \alpha^1 = \frac{V_1}{2} + \frac{U_1}{2}\sqrt{\Delta}\Rightarrow V_1 = P = 1, \quad U_1 = 1 
		\right.$$
		
		A las sucesiones de estos valores $V_n$ y $U_n$ que siguen la recurrencia que acabamos de ver es lo que
		llamaremos \textit{Sucesiones de Lucas}.
		
		\item Si $n$ es primo, tenemos que $\displaystyle |m| < |n| \Rightarrow \gcd(m, n) = 1 \quad \forall m \in
		\mathbb{Q}$ y podemos aplicar un resultado que se deduce del Pequeño Teorema de Fermat(PTF)\footnote{Hay un
		resultado análogo para $V_r$ y $U_r$ que básicamente dice que $U_r \equiv_n 0$ y que $V_r \equiv_n 2\alpha^r$.}.
		En particular, tenemos que $|2Q\Delta| < |n|$ por lo que se cumple dicho resultado:
		$$\alpha^r = \alpha^{n-\left(\frac{\Delta}{n}\right)} \equiv_n \left\lbrace
			1 \qquad \text{Si } \left(\frac{\Delta}{n}\right) = 1 \atop
			Q \qquad \text{Si } \left(\frac{\Delta}{n}\right) = -1
		\right.$$
		
		Por lo que para nuestro caso particular se tiene que $\displaystyle \alpha^r \equiv_n Q = \left(\frac{1-d}
		{4}\right) = 2$. Trivialmente se deduce que $U_r \equiv_n 0$ y $V_r \equiv_n 2Q = 4$
		
		\item Para calcular los valores $V_i$ y $U_i$ de la sucesión de Lucas(FCS) de $\alpha$ usaremos el
		siguiente algoritmo:
		\begin{algorithm}[H]
			\begin{algorithmic}[1]
				\REQUIRE \ \\
					\texttt{($P$,$Q$)}, parámetros de definición de $\alpha$ \\
					\texttt{$b =_b e_je_{j-1}e_{j-2}\dots e_2e_1e_0$}, exponente y su expresión en binario \\
					\texttt{$c$}, módulo\\ \
				\STATE{\texttt{$k = 0$}}
				\STATE{\texttt{$U_k = 0$}}
				\STATE{\texttt{$U_{k+1} = 1$}}
				\STATE{\texttt{$i = j$; $j$ es el número de dígitos en binario de $b$}}
				\WHILE{\texttt{$i > 0$}}
					\IF{\texttt{$e_i = 0$}}
						\STATE{\texttt{$(U_k, U_{k+1})= \left(2 U_k U_{k+1} - P U_k^2, \quad U_{k+1}^2 - Q U_k^2 \right) \mod c$}}
						\STATE{\texttt{$k = 2 \cdot k$}}
					\ELSE
						\STATE{\texttt{$(U_k, U_{k+1}) = \left(U_{k+1}^2 - Q U_k^2, \quad P U_{k+1}^2 - 2 Q U_k U_{k+1}\right) \mod c$}}
						\STATE{\texttt{$k = 2\cdot k + 1$}}
					\ENDIF
					\STATE{\texttt{$i = i - 1$}}
				\ENDWHILE
				\STATE{\texttt{$V_k = 2 U_{k+1} - P U_k \mod c$}}
				\PRINT{\texttt{$V_k$, $U_k$}}
			\end{algorithmic}
			\caption{Algoritmo de cálculo de la Sucesión de Lucas.}
			\label{Lucas-Suc}
		\end{algorithm}
		
		Los resultados obtenidos son:
		
		\begin{center}
			\begin{tabular}{ | r | c | c |}
				\hline
				i               & $V_i$           & $U_i$ \\
				\hline
				1               & 1               & 1 \\
				2               & 678650380744576 & 1 \\
				4               & 1               & 678650380744576 \\
				9               & 678650380744574 & 678650380744562 \\
				19              & 678650380743782 & 678650380744122 \\
				38              & 678650380331212 & 364229 \\
				77              & 337519103051    & 678385658851458 \\
				154             & 109375826287404 & 602565117149484 \\
				308             & 314372395995960 & 174542774014619 \\
				617             & 58039114661663  & 429192061200943 \\
				1234            & 107928710961106 & 551777949295122 \\
				2468            & 173384247859610 & 212210833522312 \\
				4937            & 366727320354188 & 529622479461063 \\
				9875            & 505676002010661 & 35385039382450 \\
				19751           & 102607950624073 & 589363723379602 \\
				39502           & 643340590173009 & 145092936375106 \\
				79005           & 170746732907050 & 61261644998366 \\
				158010          & 118401632948461 & 429157243036396 \\
				316021          & 397030484411688 & 570950288579416 \\
				632042          & 300481686194155 & 429410014482951 \\
				1264084         & 204971110919891 & 565762489224266 \\
				2528169         & 205528253033002 & 11298317314980 \\
				5056339         & 653791844282549 & 99791410308675 \\
				10112678        & 248067159569544 & 548776079373177 \\
				20225357        & 293048956025566 & 495082765577251 \\
				40450714        & 505417363631563 & 21391568038419 \\
				80901429        & 244273233772495 & 581989680265375 \\
				161802859       & 616720355492241 & 614229905475822 \\
				323605718       & 677684833034733 & 3681728904872 \\
				647211437       & 384717007472382 & 440081364188387 \\
				1294422875      & 311556458941962 & 468284712345335 \\
				2588845751      & 399519376303312 & 360833625919937 \\
				5177691503      & 128552669325795 & 248444453197737 \\
				10355383006     & 572489874121131 & 8385172921419 \\
				20710766013     & 289593388299130 & 371541400459837 \\
				41421532027     & 648966171804920 & 292401549856432 \\
				82843064055     & 344933393899221 & 411709447822638 \\
				165686128111    & 242032130439575 & 324117416248409 \\
				331372256222    & 548245442239833 & 652647234407392 \\
				662744512445    & 633132408951868 & 503904479244275 \\
				1325489024891   & 566661497060214 & 666226619950587 \\
				2650978049783   & 564118422945220 & 442443178508846 \\
				5301956099567   & 519463458259509 & 400839558748825 \\
				10603912199134  & 527143422327055 & 587831159199299 \\
				21207824398268  & 55227440411499  & 163953041576294 \\
				42415648796536  & 447210282631221 & 554866031163259 \\
				84831297593072  & 439417942925372 & 619271223149976 \\
				169662595186145 & 37043558831447  & 319267259707302 \\
				339325190372290 & 0               & 244551627273197 \\
				678650380744580 & 4               & 0 \\
				\hline
			\end{tabular}
		\end{center}
		
		\item Claramente, nuestro $n$ satisface los resultados teóricos que se esperan de un número primo pero
		eso no nos garantiza que sea primo. El Pequeño Teorema de Fermat(PTF) y el resultado que se deduce del
		mismo sólo nos permiten comprobar si el número es compuesto cuando no se verifican los resultados
		teóricos esperados.
	\end{enumerate}
